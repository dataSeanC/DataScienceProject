---
title: "Project: Data Science"
author: "Sean E. Curl"
date: "April 4, 2018"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(readr)
library(tidyverse)
library(styler)
library(purrr)
library(ggthemes)
library(ggmap)
library(ggplot2)
library(ggthemes)
library(purrr)
```

### Load and Clean
```{r warning=FALSE}
dataset <- read_xlsx("./globalterrorismdb_0617dist.xlsx", col_types = "text")

terrorism <- dataset %>%
  select("Year" = iyear, 
         "Month" = imonth, 
         "Day" = iday, 
         "Country" = country_txt, 
         "Region" = region_txt, 
         "AttackType" = attacktype1_txt, 
         "Target" = target1, 
         "Killed" = nkill, 
         "Wounded" = nwound, 
         "Summary" = summary, 
         "Group" = gname, 
         "Target_Type" = targtype1_txt, 
         "Weapon_type" = weapsubtype1_txt, 
         "Motive" = motive,
         "City" = city,
         "lat" = latitude,
         "lon" = longitude) %>%
  mutate(Killed = as.numeric(Killed),
         Wounded = as.numeric(Wounded),
         lat = as.numeric(lat),
         lon = as.numeric(lon)) %>%
  mutate(Casualties = Killed + Wounded) %>%
  glimpse()



terrorism %>% 
  map_dbl(~sum(is.na(.)))
```
  
## High Impact Areas
```{r}
country_highest_attacks <- terrorism %>%
  group_by(Country) %>%
  summarise(n = n()) %>%
  arrange(desc(n)) %>%
  slice(1)

region_highest_attacks <- terrorism %>%
  group_by(Region) %>%
  summarise(n = n()) %>%
  arrange(desc(n)) %>%
  slice(1)

highest_killed <- terrorism %>%
  group_by(Year, Country, Killed) %>%
  summarise(max(Killed)) %>%
  arrange(desc(Killed)) %>%
  head(1)

paste("Country with Highest Terrorist Attacks:", country_highest_attacks$Country)
paste("Region with Highest Terrorist Attacks:", region_highest_attacks$Region)
paste("Maximum peopled killed in an attack are:", "In", highest_killed$Year, highest_killed$`max(Killed)`, "peopled died in",highest_killed$Country)
```
 
## Popular Attack Types
```{r}
attacking_methods <- terrorism %>%
  group_by(AttackType) %>%
  summarise(n = n()) %>%
  arrange(n) %>%
  ggplot(mapping = aes(reorder(AttackType, -n), n, fill = AttackType)) + 
  geom_bar(stat = "identity", show.legend = FALSE) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ylab("Count") +
  xlab("Attack Type") + 
  ggtitle("Attacking Methods by Terrorists") +
  theme_classic() +
  coord_flip()

attacking_methods
```
  
## Global Terror Maps
```{r include=FALSE, cache=FALSE}
Geo.Country = geocode(unique(terrorism$Country))

```

```{r warning=FALSE}
Geo.Country$Country = unique(terrorism$Country)
Geo.Country <- Geo.Country %>%
  select(Country, lon, lat) %>%
  arrange(Country)

graph_data <- terrorism %>%
  filter(Year == "1980") %>%
  group_by(Year, Country, lon, lat, Casualties) %>%
  summarise(total = sum(Casualties))

mp <- NULL
mapWorld <- borders("world", colour="gray50", fill="gray50")
mp <- ggplot() +  mapWorld +
  geom_point(data = graph_data, mapping = aes(x=lon, y=lat, size = total, color = "#000099"), show.legend = FALSE) +
  theme_classic() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.line = element_blank()) +
  ggtitle("Casualties by Country since 1970")

mp
```
  
```{r}
test <- merge(Geo.Country, terrorism, by = "Country") %>%
  group_by(Group) %>%
  summarise(n = n()) %>%
  arrange(desc(n)) %>%
  slice(1:20)

graph_data1 <- merge(Geo.Country, terrorism, by = "Country") %>%
  filter(Group == test$Group) %>%
  group_by(Country, lon, lat, Group) %>%
  summarise(n = n()) %>%
  arrange(desc(n))

lp <- ggplot() +  mapWorld +
  geom_point(data = graph_data1, mapping = aes(x=lon, y=lat, size = n, color = Group)) +
  theme_classic() +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.line = element_blank()) +
  ggtitle("Events by the Top 20 Terrorist Organizations since 1970")
lp
```



```{r Some Basic Analysis}

# 1.2 [6]
count <- terrorism %>%
  group_by(Year) %>%
  summarise(n = n())

ggplot(count, 
       aes(x = Year, 
           y = n, fill = factor(Year))) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  xlab("Year") +
  ylab("Count") +
  ggtitle("Number of Terrorist Acivities Each Year") +
  theme_classic()

# 1.2 [11]
count <- terrorism %>%
  group_by(Target_Type) %>%
  summarise(n = n())

ggplot(count, 
       aes(reorder(x = Target_Type, -n), 
           y = n, fill = factor(Target_Type))) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  xlab("Target Type") +
  ylab("Count") +
  ggtitle("Terrorist Targets by Count") +
  theme(axis.text.x=element_text(angle = 90, hjust =1)) +
  theme_classic()

# 1.4 [11]
count <- terrorism %>%
  group_by(Region) %>%
  summarise(n = n())

ggplot(count, 
       aes(reorder(x = Region, -n), 
           y = n, fill = factor(Region))) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  xlab("Region") +
  ylab("Count") +
  ggtitle("Terrorist Attacks by Region") +
  theme(axis.text.x=element_text(angle = 90, hjust =1)) +
  theme_classic()

# 1.4 [12]
count <- terrorism %>%
  group_by(Region, Year) %>%
  summarise(n = n())

ggplot(count, 
       aes(x = Year, 
           y = n, colour = Region)) +
  geom_line(stat = "identity") +
  xlab("Year") +
  ylab("Count") +
  ggtitle("Terrorist Attacks by Region") +
  theme(axis.text.x=element_text(angle = 90, hjust =1)) +
  theme_classic()

# 1.5 [18]
count <- terrorism %>%
  filter(Group == test$Group & Group != "Unknown") %>%
  group_by(Group, Year) %>%
  summarise(n = n())

ggplot(count, 
       aes(x = Year, 
           y = n, colour = Group)) +
  geom_line(stat = "identity") +
  xlab("Year") +
  ylab("Count") +
  ggtitle("Terrorist Attacks by Group") +
  theme(axis.text.x=element_text(angle = 90, hjust =1)) +
  theme_classic()

```

